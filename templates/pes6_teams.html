{% extends "base.html" %}

{% block title %}PES6 Game Teams{% endblock %}

{% block content %}
    <h2>All PES6 Game Teams</h2>
    <p>Click on a team to see its roster and basic player information.</p>

    <p><span class="user-assigned-legend"></span> <strong>Red teams are managed by a user and cannot be selected for CPU negotiation.</strong></p>

    {% if game_teams %}
        <ul class="team-list">
            {% for team in game_teams %}
                <li class="{% if team[1] in user_assigned_team_names %}user-assigned{% endif %}"><a href="{{ url_for('pes6_team_details', team_id=team[0]) }}">{{ team[1] }}</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No PES6 teams found in the database. Please ensure you've run the import script.</p>
    {% endif %}

    <style>
        .team-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .team-list li {
            background-color: #e9e9e9;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .team-list li a {
            text-decoration: none;
            color: #337ab7;
            font-weight: bold;
            display: block;
        }
        .team-list li a:hover {
            color: #1a4f7a;
        }
        .team-list li.user-assigned {
            background-color: #d32f2f !important;
            color: #fff !important;
        }
        .team-list li.user-assigned a {
            color: #fff !important;
        }
        .user-assigned-legend {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #d32f2f;
            border-radius: 3px;
            margin-right: 6px;
            vertical-align: middle;
        }

        /* Player hover tooltip */
        .player-hover {
            position: relative;
            cursor: pointer;
        }

        .player-tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, #2a2a2a, #1f1f1f);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            color: #e0e0e0;
            z-index: 1000;
            min-width: 300px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.8);
            display: none;
        }

        .player-tooltip h4 {
            color: #ffd700;
            margin: 0 0 10px 0;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .player-tooltip .player-info {
            margin-bottom: 15px;
        }

        .player-tooltip .player-info p {
            margin: 5px 0;
            color: #e0e0e0;
        }

        .player-tooltip .player-info strong {
            color: #ffd700;
        }

        .player-tooltip .skills-chart {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .player-tooltip .skill-bar-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-tooltip .skill-label {
            min-width: 80px;
            font-size: 0.9em;
            color: #ffd700;
        }

        .player-tooltip .skill-bar {
            flex: 1;
            height: 15px;
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            border: 1px solid #444;
            border-radius: 8px;
            overflow: hidden;
        }

        .player-tooltip .skill-fill {
            height: 100%;
            border-radius: 8px;
            background: linear-gradient(90deg, #ffd700 0%, #ffed4e 100%);
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        }

        .player-tooltip .skill-value {
            min-width: 30px;
            text-align: center;
            font-size: 0.8em;
            color: #ffd700;
            font-weight: bold;
        }
    </style>

    <script>
        // Player hover tooltip functionality
        function createPlayerTooltip(playerId, playerName) {
            return fetch(`/get_player_details/${playerId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error fetching player details:', data.error);
                        return null;
                    }
                    
                    const tooltip = document.createElement('div');
                    tooltip.className = 'player-tooltip';
                    tooltip.innerHTML = `
                        <h4>${data.name}</h4>
                        <div class="player-info">
                            <p><strong>Age:</strong> ${data.age}</p>
                            <p><strong>Salary:</strong> â‚¬${data.salary.toLocaleString()}</p>
                            <p><strong>Contract:</strong> ${data.contract_years} years</p>
                        </div>
                        <div class="skills-chart">
                            ${Object.entries(data.bundled_skills).map(([skill, value]) => `
                                <div class="skill-bar-container">
                                    <div class="skill-label">${skill}</div>
                                    <div class="skill-bar">
                                        <div class="skill-fill" style="width: ${(value / 100) * 100}%;"></div>
                                    </div>
                                    <div class="skill-value">${value}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    
                    return tooltip;
                })
                .catch(error => {
                    console.error('Error:', error);
                    return null;
                });
        }

        // Add hover functionality to player names
        function addPlayerHoverFunctionality() {
            const playerNames = document.querySelectorAll('.player-name-hover');
            
            playerNames.forEach(playerName => {
                const playerId = playerName.getAttribute('data-player-id');
                const playerNameText = playerName.textContent;
                
                playerName.addEventListener('mouseenter', function() {
                    document.querySelectorAll('.player-tooltip').forEach(tooltip => tooltip.remove());
                    
                    createPlayerTooltip(playerId, playerNameText).then(tooltip => {
                        if (tooltip) {
                            this.appendChild(tooltip);
                            tooltip.style.display = 'block';
                        }
                    });
                });
                
                playerName.addEventListener('mouseleave', function() {
                    const tooltip = this.querySelector('.player-tooltip');
                    if (tooltip) {
                        tooltip.remove();
                    }
                });
            });
        }

        // Initialize hover functionality
        $(document).ready(function() {
            addPlayerHoverFunctionality();
        });
    </script>
{% endblock %}
